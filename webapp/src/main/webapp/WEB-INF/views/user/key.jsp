<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.springframework.org/tags/form" prefix="form" %>
<%@ taglib prefix="tl" tagdir="/WEB-INF/tags" %>

<tl:pageStartStandard user="${user}" pageTitle="API Key Form" includeCalendarScripts="true"/>
	
	<c:if test="${targetPage=='keyedit'}">
		<h1>Edit API key (#${apiKey.apiKeyId})</h1>
	</c:if>
	<c:if test="${targetPage=='keynew'}">
		<h1>New API key</h1>
	</c:if>
	
	<br/>
	
	<form:form method="POST" modelAttribute="apiKey">
	
		<c:if test="${notice!=null}">
			<p class="notice">
				${notice}
			</p>
		</c:if>
		<fieldset>
			<form:hidden path="apiKeyId"/>
			
			<legend>Key details</legend>
			<form:label path="label">Key label *</form:label> 
			<form:errors path="label" cssClass="validationErrors"/>
			<form:input path="label" />			
			
			<form:label path="note">Key description</form:label> 
			<form:errors path="note" cssClass="validationErrors"/>
			<form:textarea path="note" rows="4"/>
			
			<form:label path="keyStatus">Status</form:label> 
			<form:errors path="keyStatus" cssClass="validationErrors"/>
			<form:select path="keyStatus" multiple="false">
				<form:option value="" label="-----Select-----"/>
				<form:options values="${keyStatuses}" items="${keyStatuses}"/>
			</form:select>			
			
			<form:label path="startDate">Start date (leave blank for no fixed start date)</form:label> 
			<form:errors path="startDate" cssClass="validationErrors"/>
			<form:input path="startDate" cssClass="dateInput" readonly="true" style="float:left;"/>
			&nbsp;<img src="<c:url value='/includes/images/delete.png'/>" onclick="clearfield('startDate')" style="padding-top:8px;">
			<br/>
			<form:label path="endDate">End date (leave blank for no fixed end date)</form:label> 
			<form:errors path="endDate" cssClass="validationErrors"/>
			<form:input path="endDate" cssClass="dateInput" readonly="true" style="float:left;"/>
			&nbsp;<img src="<c:url value='/includes/images/delete.png'/>" onclick="clearfield('endDate')" style="padding-top:8px;">
					
			<form:label path="includeInEvent">Include Key URI in RMap Event?</form:label>
			<form:radiobutton path="includeInEvent" value="yes"/> Yes <br/>
			<form:radiobutton path="includeInEvent" value="no"/> No
			<br/>
			<em>If "Yes" is selected, RMap will generate a key URI and it will be included in the RMap:Event associated with any 
			updates performed using this key.  If you do not wish to include the key in the Event, please select "No".</em>
					
			<c:if test="${apiKey.keyUri!=null && apiKey.keyUri.length()>0}">
				<form:label path="keyUri">Key URI</form:label> 
				<form:input path="keyUri" readonly="true"/>
			</c:if>
			
			<c:if test="${targetPage==null}">
				<form:label path="keyUri">Key URI</form:label> 
				<input type="text" value="(autogenerated if used)" readonly/>
			</c:if>
					
			
			<br/>
			
		</fieldset>
		<div id="formButtons">
			<a href="<c:url value='${isAdmin ? \"/admin\":\"\"}/user/keys' />">Cancel</a>&nbsp;&nbsp;
			<input type="submit" value="Save"/>
		</div>	
	</form:form>
	<br/>
	<br/>

<tl:pageEndStandard/>